--- 11장 User Management ---

0. 개요

1. 사용자 계정 관련 파일

Q. 사용자 관리의 필요성에 대해 서술하시오
1) 리눅스는 다중 사용자 시스템이므로 사용자를 구별하고 자원을 할당해주는 방법이 필요
2) 사용자가 시스템에 접근할 수 있는 유일한 방법
3) 관리자 입장에서도 권한을 통제할 수 있는 중요한 수단

Q. /etc/passwd 파일에 대해 설명하시오
- 사용자 계정 정보가 저장된 파일
1) 로그인 ID
2) x : 예전에 쓰던 암호 필드(/etc/shadow 파일에 별도로 보관)
3) UID : User ID(일반 사용자는 1000번부터 할당)
4) GID : Group ID(/etc/group에 그룹 정보 저장)
5) 설명
6) 홈 디렉토리
7) 로그인 셸

Q. /etc/shadow 파일에 대해 설명하시오
- 사용자 암호를 관리하는 파일
- root로만 볼 수 있음
1) 로그인 ID
2) password : 암호화되어 저장
3) 최종 변경일
4) MIN : 변경한 후 사용해야 하는 최소 기간
5) MAX : 변경한 후 사용할 수 있는 최대 기간
6) WARNING : 만료되기 전 경고를 시작하는 날 수 
7) INACTIVE : 만료된 후 사용할 수 있는 기간
8) EXPIRE : 만료되는 날
9) Flag : 향후 사용할 목적으로 비워둠

- /etc/login.defs
  : 사용자 계정 설정의 기본 값을 정의하는 파일
  - PASS_MAX_DAYS, PASS_MIN_DAYS, PASS_MIN_LEN
  - UID_MIN MAX, GID_MIN MAX
  - USERDEL_CMD, CREATE_HOME, UMASK 등
  
- /etc/group
  : 그룹에 대한 정보 저장
  1) 그룹 이름
  2) x : 그룹의 암호(/etc/gshadow)
  3) GID : Group ID
  4) 그룹 멤버 : ,로 구분
  
- /etc/gshadow
  : 그룹에 대한 암호 저장
  : 유닉스에는 없고 리눅스에서 별도로 만든 파일
  1) 그룹 이름
  2) 그룹 암호 : 암호화
  3) 관리자 : 암호나 멤버를 바꿀 수 있는 사용자
  4) 그룹 멤버

2. 사용자 계정 관리 명령
- "useradd gachon" : gachon 유저 생성
- "passwd gachon" : gachon 유저 패스워드 설정
- "su gachon" : gachon 계정으로 전환
- "su - gachon" : 전환 + 홈 디렉토리로 이동
- "useradd -D gachon: : gachon 유저의 기본 설정 값 확인
  - /etc/default/useradd 파일에 저장

- /etc/skel : 사용자 홈 디렉토리에 공통으로 배포해야 할 파일을 미리 설정

- "usermod -u 1111 user1" : user1의 UID를 1111로 변경

Q. 패스워드 에이징에 대해 서술하시오
- 패스워드에 시간 개념을 도입하여 보안을 강화하는 것
1) useradd, usermod, passwd
2) chage
  - "chage -E 2018-01-01 park" : 유효기간 설정

- "userdel gachon" : gachon 유저 삭제
- "userdel -r gachon" : 유저 및 디렉토리까지 삭제(이게 안전)
- "rm -rf /home/gachon" : 강제 삭제

Q. 일반 사용자가 su 명령어를 사용하지 못하도록 하는 과정을 서술하시오
1) which su : 명령어의 위치 확인
2) chmod 4750 /bin/su
+) chmod 4755 /bin/su : 원래대로

Q. 특정 사용자만 su 명령어를 사용할 수 있도록 설정하시오.
1) vi /etc/pam.d/su
2) 주석 해제하여 wheel 설정 변경
3) 특정 사용자들을 wheel 그룹에 포함

3. 그룹 관리 명령
- "groupadd gtest" : gtest 그룹 생성
- "groupadd -g 300 gtest" : GID를 300으로 설정하여 생성
- "groupmod -g 400 gtest" : GID를 400으로 수정
- "groupmod -n newgtest gtest" : GID 이름 수정
- "groupdel gtest" : gtest 그룹 삭제
- "gpasswd -a kim gtest" : kim을 gtest 그룹에 추가
- "gpasswd -d park gtest" : park을 그룹에서 삭제
- "gpasswd gtest" : 그룹 암호 설정
- "gpasswd -r gtest" : 그룹 암호 삭제
- "newgrp newgroup" : newgroup으로 그룹 변경

4. 사용자 정보 관리 명령(p49)

Q. RUID와 EUID의 차이를 설명하시오
1) RUID(Real User ID)
  - 현재 사용자의 UID
  - who am i
2) EUID(Effective User ID)
  - 현재 명령을 수행하는 주체의 UID
  - 권한을 빌려야 할 때 구분을 위해 사용
  - whoami, id
+) 대부분 같으나 SetUID, SetGID, su, passwd 명령의 경우 EUID 값이 달라짐

- "who" : 현재 사용자 정보 출력
- "w" : who + what, who 정보에 cpu 사용량 등 시스템 정보 출력
- "last" : 로그인 정보 출력(wtmp)

- "groups" : 소속된 그룹 출력
- "groups kim" : kim이 소속된 그룹 출력

Q. sudo 권한을 설정하는 방법을 설명하시오.
1) vi /etc/sudoers
2) "gachon ALL=/usr/sbin/useradd, /usr/sbin/usermod"
  : gachon 유저에게 useradd, usermod 명령 사용 권한 추가
3) gachon으로 로그인 한 후, "sudo useradd han01"처럼 사용

- "passwd -l user2" : user2의 패스워드 잠금
  -> /etc/shadow 파일 비밀번호 앞에 !! 붙음
- "passwd -u user2" : user2의 패스워드 잠금 해제
- "passwd -d user2" : user2의 패스워드 삭제

- "chown user1 hosts" : hosts 파일의 소유자를 user1로 변경
- "chown -R user1:han01 temp" : temp 디렉토리의 소유자를 user1, 소유 그룹을 han01로 바꾸고 하위 디렉토리에도 적용
- "chgrp -R user2 temp" : temp 디렉토리의 소유 그룹을 user2로 변경